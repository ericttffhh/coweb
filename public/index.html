<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç§äººå½±é™¢ - ç„¡å»£å‘Šç´”æ·¨ç‰ˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f0f0f; color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .navbar { background-color: #1a1a1a !important; border-bottom: 1px solid #333; }
        .video-card { background: #1a1a1a; border: none; border-radius: 12px; transition: 0.3s; cursor: pointer; overflow: hidden; height: 100%; }
        .video-card:hover { transform: translateY(-5px); background: #252525; }
        .video-card img { height: 160px; object-fit: cover; }
        .card-text { font-size: 0.85rem; padding: 10px; height: 3rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: #ccc; }
        #player-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; z-index: 10000; flex-direction: column; align-items: center; justify-content: center; }
        .close-btn { position: absolute; top: 20px; right: 30px; font-size: 35px; color: #fff; cursor: pointer; }
        iframe { width: 90%; height: 80%; border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container d-flex justify-content-between">
        <span class="navbar-brand mb-0 h1">ğŸ¥ ç§äººç„¡å»£å‘Šå½±é™¢</span>
        <button class="btn btn-outline-info btn-sm" onclick="loadVideos()">ğŸ”„ é‡æ–°æ•´ç†</button>
    </div>
</nav>

<div class="container">
    <div class="row g-3" id="video-list">
        <div class="text-center my-5"><div class="spinner-border text-primary" role="status"></div><p class="mt-2">æ­£åœ¨è¼‰å…¥ç‰‡æº...</p></div>
    </div>
</div>

<div id="player-overlay">
    <span class="close-btn" onclick="closePlayer()">&times;</span>
    <div id="loading-video" class="text-center">
        <div class="spinner-border text-light" role="status"></div>
        <p class="mt-3">æ­£åœ¨æ’é™¤å»£å‘Šä¸¦è§£æå½±ç‰‡...</p>
    </div>
    <iframe id="main-player" src="" frameborder="0" allowfullscreen style="display:none;"></iframe>
</div>

<script>
    async function loadVideos() {
        const list = document.getElementById('video-list');
        list.innerHTML = '<div class="col-12 text-center my-5"><div class="spinner-border text-primary"></div></div>';
        try {
            const response = await fetch('/api/videos');
            const videos = await response.json();
            if (videos.error) throw new Error(videos.error);
            list.innerHTML = videos.map(v => `
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="card video-card" onclick="playVideo('${v.link}')">
                        <img src="${v.thumb}" onerror="this.src='https://placehold.co/300x200?text=No+Image'">
                        <div class="card-body p-0"><p class="card-text">${v.title}</p></div>
                    </div>
                </div>
            `).join('');
        } catch (err) {
            list.innerHTML = `<div class="col-12 text-center text-danger">è¼‰å…¥å¤±æ•—: ${err.message}</div>`;
        }
    }

    async function playVideo(url) {
        const overlay = document.getElementById('player-overlay');
        const player = document.getElementById('main-player');
        const loading = document.getElementById('loading-video');
        overlay.style.display = 'flex';
        loading.style.display = 'block';
        player.style.display = 'none';
        try {
            const res = await fetch(`/api/parse-video?url=${encodeURIComponent(url)}`);
            const data = await res.json();
            if (data.src) {
                player.src = data.src;
                loading.style.display = 'none';
                player.style.display = 'block';
            } else { alert("è§£æå¤±æ•—"); closePlayer(); }
        } catch { alert("ç¶²è·¯é€£ç·šéŒ¯èª¤"); closePlayer(); }
    }

    function closePlayer() {
        document.getElementById('player-overlay').style.display = 'none';
        document.getElementById('main-player').src = '';
    }
    window.onload = loadVideos;
</script>
</body>
</html>